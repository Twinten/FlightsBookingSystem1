'use strict';function e(e,r){for(var n in e)r(e[n],n)}function r(e,r){e.forEach(r)}function n(e,r,n){if(!e)throw Error((n?n+': ':'')+r)}function t(e,r){var n=j(e),t=n.meta||{};B(e)||(t.isRegion=1),re={id:n.id,parent:re,value:e,template:t.template||te(),sidRoot:t.sidRoot||re&&re.sidRoot,meta:t};try{return r()}finally{ne('region'),re=I(re)}}function a(e){var n=void 0===e?{}:e,t=n.node,a=void 0===t?[]:t,i=n.parent,o=n.child,u=void 0===o?n.to||n.target:o,s=n.scope,f=void 0===s?{}:s,c=n.meta,d=void 0===c?{}:c,l=n.family,p=void 0===l?{type:'regular'}:l,v=n.regional,m=oe(void 0===i?n.from||n.source:i),g=oe(p.links),h=oe(p.owners),y=[];r(a,(function(e){return e&&$(y,e)}));var b={id:Z(),seq:y,next:oe(u),meta:d,scope:f,family:{triggers:m.length,type:p.type||"crosslink",links:g,owners:h}};return r(g,(function(e){return $(z(e),b)})),r(h,(function(e){return $(O(e),b)})),r(m,(function(e){return $(e.next,b)})),v&&re&&ie(C(re),[b]),b}function i(e,n,t){var a,i=We,o=null,u=Fe;if(e.target&&(n=e.params,t=e.defer,a=e.meta,i='page'in e?e.page:i,e.stack&&(o=e.stack),u=R(e)||u,e=e.target),u&&Fe&&u!==Fe&&(Fe=null),Array.isArray(e))for(var s=0;s<e.length;s++)Ee('pure',i,j(e[s]),o,n[s],u,a);else Ee('pure',i,j(e),o,n,u,a);if(!t||Ve){var f,c,d,l,p,v,m={isRoot:Ve,currentPage:We,scope:Fe,isWatch:Le,isPure:Be};Ve=0;for(var g=function(){var e=l.idx,n=l.stack,t=l.type;d=n.node,We=p=n.page,Fe=R(n),p?v=p.reg:Fe&&(v=Fe.reg);var a=!!p,i=!!Fe,o={fail:0,scope:d.scope};f=c=0;for(var u=e;u<d.seq.length&&!f;u++){var s=d.seq[u];if(s.order){var g=s.order,h=g.priority,y=g.barrierID,b=y?p?p.fullID+"_"+y:y:0;if(u!==e||t!==h)return y?Pe.has(b)||(Pe.add(b),Te(u,n,h,y)):Te(u,n,h,0),"continue|kernelLoop";y&&Pe.delete(b)}switch(s.type){case'mov':var k=s.data,w=void 0;switch(k.from){case'stack':w=C(n);break;case'a':case'b':w=n[k.from];break;case'value':w=k.store;break;case'store':if(v&&!v[k.store.id])if(a){var x=Ue(p,k.store.id);n.page=p=x,x?v=x.reg:i?(Ke(Fe,k.store,0,1,k.softRead),v=Fe.reg):v=void 0}else i&&Ke(Fe,k.store,0,1,k.softRead);w=ze(v&&v[k.store.id]||k.store)}switch(k.to){case'stack':n.value=w;break;case'a':case'b':n[k.to]=w;break;case'store':$e(p,Fe,k.target,0).current=w}break;case'compute':var S=s.data;if(S.fn){Le='watch'===d.meta.op,Be=S.pure;var M=S.safe?(0,S.fn)(C(n),o.scope,n):Qe(o,S.fn,n);S.filter?c=!M:n.value=M,Le=m.isWatch,Be=m.isPure}}f=o.fail||c}if(De&&De(n,o),!f){var A=C(n),j=R(n);if(r(d.next,(function(e){Ee('child',p,e,n,A,j)})),j){d.meta.needFxCounter&&Ee('child',p,j.fxCount,n,A,j),d.meta.storeChange&&Ee('child',p,j.storeChange,n,A,j),d.meta.warnSerialize&&Ee('child',p,j.warnSerializeNode,n,A,j);var z=j.additionalLinks[d.id];z&&r(z,(function(e){Ee('child',p,e,n,A,j)}))}}};l=qe();)g();Ve=m.isRoot,We=m.currentPage,Fe=R(m)}}function o(r,n){void 0===n&&(n='combine');var t=n+'(',a='',i=0;return e(r,(function(e){i<25&&(null!=e&&(t+=a,t+=E(e)?q(e).fullName:e.toString()),i+=1,a=', ')})),t+')'}function u(e,r){var n,t,a=e;if(r){var i=q(r);0===e.length?(n=i.path,t=i.fullName):(n=i.path.concat([e]),t=0===i.fullName.length?e:i.fullName+'/'+e)}else n=0===e.length?[]:[e],t=e;return{shortName:a,fullName:t,path:n}}function s(e,r){if(!r)return e;if(!r.name&&!r.named&&!r.loc)return e;var n="["+e+"]",t=r.named||r.name;t&&(n+=" unit '"+t+"'");var a=r.loc;return!t&&a&&(n+=" ("+a.file+":"+a.line+":"+a.column+")"),n}function f(e,r){var n=r?e:e[0];ce(n);var t=n.or,a=n.and;if(a){var i=r?a:a[0];if(ue(i)&&'and'in i){var o=f(a,r);e=o[0],t=Object.assign({},t,o[1])}else e=a}return[e,t]}function c(e){var r=function(){return e()};return r.unsubscribe=function(){return e()},r}function d(e){var r=te();if(r){for(var n=r.handlers[e],t=arguments.length,a=new Array(t>1?t-1:0),i=1;i<t;i++)a[i-1]=arguments[i];if(n)return n.apply(void 0,[r].concat(a))}}function l(e,r,n,t){var a=We,i=null;if(r)for(i=We;i&&i.template!==r;)i=I(i);He(i);var o=e.create(n,t);return He(a),o}function p(e,r){var t=Xe({or:r,and:'string'==typeof e?{name:e}:e}),o=s('event',t),u=function e(r){n(!F(e,'derived'),'call of derived event is not supported, use createEvent instead',o),n(!Be,'unit call from pure function is not supported, use operators like sample instead',o);for(var t=arguments.length,a=new Array(t>1?t-1:0),i=1;i<t;i++)a[i-1]=arguments[i];return We?l(e,f,r,a):e.create(r,a)},f=te(),c=Object.assign(u,{graphite:a({meta:ur(t.actualOp||"event",u,t),regional:1}),create:function(e){return i({target:u,params:e,scope:Fe}),e},watch:function(e){return ir(u,e)},map:function(e){return sr(u,A,e,[Me()])},filter:function(e){return sr(u,'filter',e.fn?e:e.fn,[Me(ge,1)])},filterMap:function(e){return sr(u,'filterMap',e,[Me(),xe((function(e){return!fe(e)}),1)])},prepend:function(e){n(u.targetable,'.prepend of derived event is not supported, call source event instead',o);var r=p('* \u2192 '+u.shortName,{parent:I(u)});return d('eventPrepend',j(r)),ar(r,u,[Me()],'prepend',e),or(u,r),r}});return null!=t&&t.domain&&t.domain.hooks.event(c),D(c,'id',c.graphite.id),ne(c.graphite),c}function v(e,t,a,i,o){return le(a,o+" "+t,'first argument'),n(se(i),'second argument should be a function',o),J(!F(e,'derived'),t+" in derived store",t+" in store created via createStore",o),r(Array.isArray(a)?a:[a],(function(r){e.off(r),cr(r,e,'on',me,i)})),e}function m(e,t){var o=Xe(t),u=je(e),f=s('store',o),c=Error();Error.captureStackTrace&&Error.captureStackTrace(c,m);var l=c.stack,g=p({named:'updates',derived:1});d('storeBase',u);var h=u.id,y='skipVoid'in o,b=y&&!o.skipVoid;J(!(y&&o.skipVoid),'{skipVoid: true}','updateFilter',f);var k={updates:g,defaultState:e,stateRef:u,getState:function(){var e,r=u;if(We){for(var n=We;n&&!n.reg[h];)n=I(n);n&&(e=n)}return!e&&Fe&&(Ke(Fe,u,1),e=Fe),e&&(r=e.reg[h]),ze(r)},setState:function(e){return i({target:k,params:e,defer:1,scope:Fe})},reset:function(){n(k.targetable,'.reset of derived store is not supported',f);for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return r(t,(function(e){return v(k,'.reset',e,(function(){return k.defaultState}),f)})),k},on:function(e,r){return n(k.targetable,'.on of derived store is not supported',f),v(k,'.on',e,r,f)},off:function(e){var r=j(e).id,n=j(k).family.links.find((function(e){return e.meta.onTrigger===r}));return n&&nr(n),k},map:function(e,r){var n,t;ue(e)&&(n=e,e=e.fn);var a=k.getState(),i=fe(a);te()?t=null:(!i||i&&b)&&(t=e(a));var o=m(t,Object.assign({name:k.shortName+" \u2192 *",derived:1},r,{and:n})),s=cr(k,o,A,ge,e);return Oe(N(o),{type:A,fn:e,from:u}),N(o).noInit=1,d('storeMap',u,s),o},watch:function(e,r){if(J(!r,'watch second argument','sample',f),!r||!E(e)){var t=ir(k,e);return d('storeWatch',u,e)||e(k.getState()),t}return n(se(r),'second argument should be a function',f),e.watch((function(e){return r(k.getState(),e)}))}},w=ur("store",k,o),x=k.defaultConfig.updateFilter;k.graphite=a({scope:{state:u,fn:x},node:[xe((function(e,r,n){return n.scope&&!n.scope.reg[u.id]&&(n.b=1),e})),Se(u),xe((function(e,r,n){var t=n.a,a=n.b,i=fe(e);return i&&!y&&K(f+": "+fr,l),(i&&b||!i)&&(e!==t||a)}),1),x&&Me(ve,1),be({from:"stack",target:u})],child:g,meta:Object.assign({},w,{defaultState:e,storeTrace:l}),regional:1}),D(k,'id',k.graphite.id),D(k,'rootStateRefId',h);var S=F(k,'serialize'),M=F(k,'derived'),z='ignore'===S,O=F(k,'sid');O&&(D(k,'storeChange',1),u.sid=O),O||z||M||D(k,'warnSerialize',1);var C=fe(e);return n(M||!C||C&&b,fr,f),M&&C&&!y&&console.error(f+": "+fr),ie(k,[g]),null!=o&&o.domain&&o.domain.hooks.store(k),M||(k.reinit=p({named:'reinit'}),k.reset(k.reinit)),u.meta=k.graphite.meta,ne(k.graphite),k}function g(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];var a,i,o,u=f(r);r=u[0];var c,d,l,p=s('combine',o=u[1]),v=r[r.length-1],m=r.length>1&&!_(v)&&ue(v),g=m&&v,h=m?r[r.length-2]:v;if(se(h)?(i=r.slice(0,m?-2:-1),a=h):i=r,1===i.length){var y=i[0];_(y)||(c=y,d=1)}if(!d&&(c=i,a)){l=1;var b=a;a=function(e){return b.apply(void 0,e)}}return n(ue(c),p+": shape should be an object"),dr(Array.isArray(c),!l,c,o,a,g)}function h(){var e={};return e.req=new Promise((function(r,n){e.rs=r,e.rj=n})),e.req.catch((function(){})),e}function y(e,r){void 0===r&&(r={});var t=Xe(se(e)?{handler:e}:e,r),o=s('effect',t),u=p(se(e)?{handler:e}:e,Object.assign({},r,{actualOp:"effect"})),f=j(u);D(f,'op',u.kind="effect"),u.use=function(e){return n(se(e),'.use argument should be a function',o),y.scope.handler=e,u},u.use.getCurrent=function(){return y.scope.handler};var c=u.finally=p({named:'finally',derived:1}),d=u.done=c.filterMap({named:'done',fn:function(e){if('done'===e.status)return{params:e.params,result:e.result}}}),l=u.fail=c.filterMap({named:'fail',fn:function(e){if('fail'===e.status)return{params:e.params,error:e.error}}}),v=u.doneData=d.map({named:'doneData',fn:function(e){return e.result}}),g=u.failData=l.map({named:'failData',fn:function(e){return e.error}}),y=a({scope:{handler:u.defaultConfig.handler||function(){return n(0,"no handler used in "+u.compositeName.fullName)}},node:[xe((function(e,r,n){var t=r.handler,a=R(n);if(a){var i=a.handlers.unitMap.get(u)||a.handlers.sidMap[u.sid];i&&(t=i)}return e.handler=t,e}),0,1),xe((function(e,r,n){if(!r.runnerFn||r.runnerFn(e,null,n)){var t=e.params,a=e.req,i=e.handler,o=e.args,u=void 0===o?[t]:o,s=pr(t,a,1,c,n),f=pr(t,a,0,c,n),d=lr(i,f,u),l=d[1];d[0]&&(ue(l)&&se(l.then)?l.then(s,f):s(l))}}),0,1)],meta:{op:'fx',fx:'runner'},regional:1});f.scope.runner=y,$(f.seq,xe((function(e,r,n){var t=r.runner,a=I(n)?{params:e,req:{rs:function(){},rj:function(){}}}:e;return n.meta||(n.meta={fxID:ee()}),i({target:t,params:a,defer:1,scope:R(n),meta:n.meta}),a.params}))),u.create=function(e){var r=h(),n={params:e,req:r};if(Fe&&!Le){var t=Fe;r.req.finally((function(){Ge(t)})).catch((function(){}))}return i({target:u,params:n,scope:Fe}),r.req};var b=u.inFlight=m(0,{serialize:'ignore',named:(F(u,'name')||u.graphite.id)+'.inFlight'}).on(u,(function(e){return e+1})).on(c,(function(e){return e-1})).map({fn:function(e){return e},named:'inFlight'});D(c,'needFxCounter','dec'),D(u,'needFxCounter',1);var k=u.pending=b.map({fn:function(e){return e>0},named:'pending'});return ie(u,[c,d,l,v,g,k,b]),null!=t&&t.domain&&t.domain.hooks.effect(u),u}function b(e,t){var a=0;return r(mr,(function(r){r in e&&(n(null!=e[r],gr(t,r)),a=1)})),a}function k(e,n,t){var a=[];(function e(i){H(a,i)||($(a,i),"store"===F(i,'op')&&(t||F(i,'sid'))&&n(i,F(i,'sid')),r(i.next,e),r(z(i),e),r(O(i),e))})(e)}function w(e,t){var a=Array.isArray(e)?new Map(e):e,i=new Map,o=0;if(a instanceof Map){var u={};return r(a,(function(e,r){n(E(r),'Map key should be a unit'),t&&t(r,e),r.sid&&(r.sid in u&&(o=1),u[r.sid]=e),i.set(r,e)})),{sidMap:u,unitMap:i,hasSidDoubles:o}}return{sidMap:a,unitMap:i}}function x(e,r){return _(r)?[Ae.mov({store:r.stateRef,to:'stack'})].concat(e):e}Object.defineProperty(exports,'__esModule',{value:1});for(var S,M='undefined'!=typeof Symbol&&Symbol.observable||'@@observable',A='map',j=function(e){return e.graphite||e},z=function(e){return e.family.owners},O=function(e){return e.family.links},N=function(e){return e.stateRef},C=function(e){return e.value},I=function(e){return e.parent},R=function(e){return e.scope},F=function(e,r){return j(e).meta[r]},D=function(e,r,n){return j(e).meta[r]=n},q=function(e){return e.compositeName},E=function(e){return(se(e)||ue(e))&&'kind'in e},T=function(e){return function(r){return E(r)&&r.kind===e}},_=T("store"),P=T("event"),V=T("effect"),L=function(e){return E(e)&&!!e.targetable},B=T("domain"),W=T("scope"),G={__proto__:null,unit:E,store:_,event:P,effect:V,targetable:L,domain:B,scope:W,attached:function(e){return V(e)&&1==F(e,'attached')}},H=function(e,r){return e.includes(r)},U=function(e,r){var n=e.indexOf(r);-1!==n&&e.splice(n,1)},$=function(e,r){return e.push(r)},J=function(e,r,n,t){return!e&&console.error((t?t+': ':'')+r+" is deprecated"+(n?", use "+n+" instead":''))},K=function(e,r){var n=Error(e);n.stack=r,console.error(n)},Q=function(){var e=0;return function(){return""+ ++e}},X=Q(),Y=Q(),Z=Q(),ee=Q(),re=null,ne=function(e){S&&S(e,re)},te=function(){return re&&re.template},ae=function(e){return e&&re&&re.sidRoot&&(e=re.sidRoot+"|"+e),e},ie=function(e,n){var t=j(e);r(n,(function(e){var r=j(e);"domain"!==t.family.type&&(r.family.type="crosslink"),$(z(r),t),$(O(t),r)}))},oe=function(e){return void 0===e&&(e=[]),(Array.isArray(e)?e:[e]).flat().map(j)},ue=function(e){return'object'==typeof e&&null!==e},se=function(e){return'function'==typeof e},fe=function(e){return void 0===e},ce=function(e){return n(ue(e)||se(e),'expect first argument be an object')},de=function(e,r,t,a){return n(!(!ue(e)&&!se(e)||!('family'in e)&&!('graphite'in e)),r+": expect "+t+" to be a unit (store, event or effect)"+a)},le=function(e,n,t){Array.isArray(e)?r(e,(function(e,r){return de(e,n,r+" item of "+t,'')})):de(e,n,t,' or array of units')},pe=function(e,t,a){return void 0===a&&(a='target'),r(oe(t),(function(r){return n(!F(r,'derived'),e+": derived unit in \""+a+"\" is not supported, use createStore/createEvent instead\"")}))},ve=function(e,r,n){return(0,r.fn)(e,n.a)},me=function(e,r,n){return(0,r.fn)(n.a,e)},ge=function(e,r){return(0,r.fn)(e)},he=function(e,r,n,t){var a={id:Y(),type:e,data:r};return n&&(a.order={priority:n},t&&(a.order.barrierID=++ye)),a},ye=0,be=function(e){var r=e.from,n=e.target,t=e.to;return he('mov',{from:void 0===r?"store":r,store:e.store,to:void 0===t?n?"store":"stack":t,target:n},e.priority,e.batch)},ke=function(e){var r=e.safe,n=e.filter,t=e.pure;return he('compute',{fn:e.fn,safe:void 0===r?0:r,filter:void 0===n?0:n,pure:void 0===t?0:t},e.priority,e.batch)},we=function(e){return ke({fn:e.fn,priority:"effect"})},xe=function(e,r,n){return ke({fn:e,safe:1,filter:r,priority:n&&"effect"})},Se=function(e,r,n){return be({store:e,to:r?"stack":"a",priority:n&&"sampler",batch:1})},Me=function(e,r){return void 0===e&&(e=ge),ke({fn:e,pure:1,filter:r})},Ae={mov:be,compute:ke,filter:function(e){return ke({fn:e.fn,filter:1,pure:e.pure})},run:we},je=function(e){return{id:Y(),current:e,initial:e}},ze=function(e){return e.current},Oe=function(e,r){e.before||(e.before=[]),$(e.before,r)},Ne=null,Ce=function e(r,n){return r?n?((r.v.type===n.v.type&&r.v.id>n.v.id||_e(r.v.type)>_e(n.v.type))&&(t=r,r=n,n=t),t=e(r.r,n),r.r=r.l,r.l=t,r):r:n;var t},Ie=[],Re=0;Re<6;)$(Ie,{first:null,last:null,size:0}),Re+=1;var Fe,De,qe=function(){for(var e=0;e<6;e++){var r=Ie[e];if(r.size>0){if(3===e||4===e){r.size-=1;var n=Ne.v;return Ne=Ce(Ne.l,Ne.r),n}1===r.size&&(r.last=null);var t=r.first;return r.first=t.r,r.size-=1,t.v}}},Ee=function(e,r,n,t,a,i,o){return Te(0,{a:null,b:null,node:n,parent:t,value:a,page:r,scope:i,meta:o},e,0)},Te=function(e,r,n,t){var a=_e(n),i=Ie[a],o={v:{idx:e,stack:r,type:n,id:t},l:null,r:null};3===a||4===a?Ne=Ce(Ne,o):(0===i.size?i.first=o:i.last.r=o,i.last=o),i.size+=1},_e=function(e){switch(e){case'child':return 0;case'pure':return 1;case'read':return 2;case'barrier':return 3;case'sampler':return 4;case'effect':return 5;default:return-1}},Pe=new Set,Ve=1,Le=0,Be=0,We=null,Ge=function(e){Fe=e},He=function(e){We=e},Ue=function(e,r){if(e){for(;e&&!e.reg[r];)e=e.parent;if(e)return e}return null},$e=function(e,r,n,t){var a=Ue(e,n.id);return a?a.reg[n.id]:r?(Ke(r,n,t),r.reg[n.id]):n},Je=function(e){return e},Ke=function e(n,t,a,i,o){var u=n.reg;if(!u[t.id]){var s=t.sid,f={id:t.id,current:t.initial,meta:t.meta};if(f.id in n.values.idMap)f.current=n.values.idMap[f.id];else if(s&&s in n.values.sidMap&&!(s in n.sidIdMap)){var c,d=null==t||null===(c=t.meta)||void 0===c?void 0:c.serialize;f.current=(n.fromSerialize&&'ignore'!==d&&(null==d?void 0:d.read)||Je)(n.values.sidMap[s])}else if(t.before&&!o){var l=0,p=a||!t.noInit||i;r(t.before,(function(r){switch(r.type){case'map':var t=r.from;if((t||r.fn)&&(t&&e(n,t,a,i),p)){var o=t&&u[t.id].current;f.current=r.fn?r.fn(o):o}break;case'field':e(n,r.from,a,i),l||(l=1,f.current=Array.isArray(f.current)?[].concat(f.current):Object.assign({},f.current)),p&&(f.current[r.field]=u[u[r.from.id].id].current)}}))}s&&(n.sidIdMap[s]=t.id),u[t.id]=f}},Qe=function(e,r,n){try{return r(C(n),e.scope,n)}catch(t){console.error(t),e.fail=1,e.failReason=t}},Xe=function r(n,t){return void 0===t&&(t={}),ue(n)&&(r(n.or,t),e(n,(function(e,r){fe(e)||'or'===r||'and'===r||(t[r]=e)})),r(n.and,t)),t},Ye=function(e,r){U(e.next,r),U(z(e),r),U(O(e),r)},Ze=['on','reset','sample','split','merge','guard','forward'],er=function e(r,n,t,a,i){var o;r.next.length=0,r.seq.length=0,r.scope=null;var u=O(r),s=r.meta.isRegion,f=s?r:a;if(u.length>0)for(var c=H(Ze,r.meta.op),d=!s&&!i,l=d&&t&&!c;o=u.pop();){var p=H(o.next,r);Ye(o,r),s&&e(o,0,0,r,1),p||(o.family.triggers-=1),(n||l||d&&"crosslink"===o.family.type&&!c||i&&H(Ze,o.meta.op)&&(p&&0===o.next.length||!p&&o.family.triggers<=0))&&e(o,n,t&&'on'!==o.meta.op,f,i)}for(u=z(r);o=u.pop();)Ye(o,r),t&&"crosslink"===o.family.type&&e(o,n,'on'!==o.meta.op,f,i)},rr=function(e){return e.clear()},nr=function(e,r){var n=(void 0===r?{}:r).deep,t=0;if(e.ownerSet&&e.ownerSet.delete(e),B(e)){t=1;var a=e.history;rr(a.events),rr(a.effects),rr(a.stores),rr(a.domains)}er(j(e),!!n,t,null,0)},tr=function(e){return c((function(){return nr(e)}))},ar=function(e,r,n,t,i){return a({node:n,parent:e,child:r,scope:{fn:i},meta:{op:t},family:{owners:[e,r],links:r},regional:1})},ir=function(e,r){return n(se(r),'.watch argument should be a function'),tr(a({scope:{fn:r},node:[we({fn:ge})],parent:e,meta:{op:'watch'},family:{owners:e},regional:1}))},or=function(e,r,n){void 0===n&&(n="event"),I(e)&&I(e).hooks[n](r)},ur=function(e,r,n){var t=Xe(n),a="domain"===e,i=X(),o=t.sid,s=void 0===o?null:o,f=t.named,c=void 0===f?null:f,d=t.domain,l=t.parent,p=void 0===l?void 0===d?null:d:l,v=c||t.name||(a?'':i),m=u(v,p),g={op:r.kind=e,name:r.shortName=v,sid:r.sid=ae(s),named:c,unitId:r.id=i,serialize:t.serialize,derived:t.derived,config:t};if(r.targetable=!t.derived,r.parent=p,r.compositeName=m,r.defaultConfig=t,r.getType=function(){return J(0,'getType','compositeName.fullName'),m.fullName},!a){r.subscribe=function(e){return ce(e),r.watch(se(e)?e:function(r){return e.next&&e.next(r)})},r[M]=function(){return r};var h=te();h&&(g.nativeTemplate=h)}return g},sr=function(e,r,n,t){var a;ue(n)&&(a=n,n=n.fn);var i=p({name:e.shortName+" \u2192 *",derived:1,and:a});return ar(e,i,t,r,n),i},fr='undefined is used to skip updates. To allow undefined as a value provide explicit { skipVoid: false } option',cr=function(e,r,n,t,a){var i=N(r),o=be({store:i,to:"a",priority:'read'});n===A&&(o.data.softRead=1);var u=[o,Me(t)];d('storeOnMap',i,u,_(e)&&N(e));var s=ar(e,r,u,n,a);return n!==A&&D(s,'onTrigger',j(e).id),s},dr=function(r,t,a,i,u,f){var c=s('combine',i),l=r?function(e){return[].concat(e)}:function(e){return Object.assign({},e)},p=r?[]:{},v=l(p),g=je(v),h=je(1);g.type=r?'list':'shape',g.noInit=1,d('combineBase',g,h);var y=m(v,Object.assign({name:o(a),derived:1},f,{and:i})),b=N(y);b.noInit=1,D(y,'isCombine',1);var k=Se(g);k.order={priority:'barrier'};var w=be({store:b,to:'b',priority:'read'});w.data.softRead=1;var x=[xe((function(e,r,n){return n.scope&&!n.scope.reg[g.id]&&(n.c=1),e})),k,be({store:h,to:'b'}),xe((function(e,r,n){var a=r.key;if(n.c||e!==n.a[a])return t&&n.b&&(n.a=l(n.a)),n.a[a]=e,1}),1),be({from:"a",target:g}),be({from:"value",store:0,target:h}),be({from:"value",store:1,target:h,priority:'barrier',batch:1}),Se(g,1,1),u&&Me(),w];if(e(a,(function(e,r){if(!_(e))return n(!E(e)&&!fe(e),"combine expects a store in a field "+r,c),void(v[r]=p[r]=e);p[r]=e.defaultState,v[r]=e.getState();var t=ar(e,y,x,'combine',u);t.scope.key=r;var a=N(e);Oe(g,{type:'field',field:r,from:a}),d('combineField',a,t)})),y.defaultShape=a,Oe(b,{type:A,from:g,fn:u}),!te())if(u){var S=u(v);!fe(S)||f&&'skipVoid'in f||console.error(c+": "+fr),b.current=S,b.initial=S,y.defaultState=S}else y.defaultState=p;return y},lr=function(e,r,n){try{return[1,e.apply(void 0,n)]}catch(t){return r(t),[0,null]}},pr=function(e,r,n,t,a){return function(o){i({target:[t,vr],params:[n?{status:'done',params:e,result:o}:{status:'fail',params:e,error:o},{value:o,fn:n?r.rs:r.rj}],defer:1,page:a.page,scope:a.scope,meta:a.meta})}},vr=a({node:[we({fn:function(e){return(0,e.fn)(e.value)}})],meta:{op:'fx',fx:'sidechain'}}),mr=['source','clock','target'],gr=function(e,r){return e+": "+r+" should be defined"},hr=function(e,r,t,a,i,o,u,f,c,l,v,h){var y=s(e,f),b=!!i;n(!fe(t)||!fe(r),gr(y,'either source or clock'));var k=0;fe(t)?k=1:E(t)||(t=g(t)),fe(r)?r=t:(le(r,y,'clock'),Array.isArray(r)&&(r=ar(r,[],[],e))),k&&(t=r),f||u||(u=t.shortName);var w='none';(v||a)&&(E(a)?w='unit':(n(se(a),'`filter` should be function or unit'),w='fn')),i?(le(i,y,'target'),pe(y,i)):'none'===w&&l&&_(t)&&_(r)?i=m(o?o(ze(N(t)),ze(N(r))):ze(N(t)),{name:u,sid:h,or:f}):(i=p({name:u,derived:1,or:f}),d('sampleTarget',j(i)));var x=je(),S=[];if('unit'===w){var M=br(a,i,r,x,e),A=M[0];M[2]||S.push.apply(S,yr(M[1])),S.push.apply(S,yr(A))}var z=[];if(k)c&&z.push(Se(x,1,1));else{var O=br(t,i,r,x,e),C=O[0];O[2]||z.push.apply(z,yr(O[1])),z.push(Se(C,1,c))}var I=ar(r,i,[d('sampleSourceLoader'),be({from:"stack",target:x})].concat(z,S,[Se(x),'fn'===w&&Me((function(e,r,n){return a(e,n.a)}),1),o&&Me(ve),d('sampleSourceUpward',b)]),e,o);return ie(t,[I]),Object.assign(I.meta,f,{joint:1}),i},yr=function(e){return[Se(e),xe((function(e,r,n){return n.a}),1)]},br=function(e,r,n,t,i){var o=_(e),u=o?N(e):je(),s=je(o);return o||a({parent:e,node:[be({from:"stack",target:u}),be({from:"value",store:1,target:s})],family:{owners:[].concat(new Set([e,r,n].flat())),links:r},meta:{op:i},regional:1}),d('sampleSource',s,u,t),[u,s,o]},kr=function(e,r,n,t){var a=e[r];a&&i({target:a,params:Array.isArray(a)?a.map((function(){return n})):n,defer:1,stack:t})},wr=function(e){return!e.node.meta.isCombine||e.parent&&'combine'!==e.parent.node.meta.op},xr=function(e){return e};exports.allSettled=function(e,r){var n=void 0===r?{}:r,t=n.scope,a=n.params;if(!E(e))return Promise.reject(new Error('first argument should be unit'));if(!(V(e)||P(e)||_(e)||W(e)))return Promise.reject(new Error('first argument accepts only effects, events, stores or scopes'));if(W(e))t=e;else if(!L(e)){var o=s('allSettled',j(e).meta);return Promise.reject(Error(o+": unit should be targetable"))}var u=h();u.parentFork=Fe;var f=t.fxCount;$(f.scope.defers,u);var c=[],d=[];return W(e)||($(c,e),$(d,V(e)?{params:a,req:{rs:function(e){u.value={status:'done',value:e}},rj:function(e){u.value={status:'fail',value:e}}}}:a)),$(c,f),$(d,null),i({target:c,params:d,scope:t}),u.req},exports.attach=function(e){var r,t,a=f(e,1);e=a[0];var o=s('attach',t=a[1]),c=e.source,d=e.effect,l=e.mapParams,p=e.domain;V(d)&&n(fe(p),'`domain` can only be used with a plain function',o);var v=y(e,t);D(v,'attached',1);var m,h,b=j(v).scope.runner,k=function(e,r,n){var t,a=e.params,o=e.req,u=e.handler,s=v.finally,f=pr(a,o,0,s,n),d=n.a,p=V(u),m=1;if(l){var g=lr(l,f,[a,d]);m=g[0],t=g[1]}else t=c&&p?d:a;if(m){if(!p)return e.args=[d,t],1;i({target:u,params:{params:t,req:{rs:pr(a,o,1,s,n),rj:f}},page:n.page,defer:1,meta:n.meta})}};c?(b.scope.runnerFn=k,_(c)?ie(h=c,[v]):(h=g(c),ie(v,[h])),m=[xe((function(e){return e}),0,1),Se(N(h))],delete b.seq[1].order):m=[xe(k,1,1)],(r=b.seq).splice.apply(r,[1,0].concat(m)),v.use(d);var w=I(d);return w&&(Object.assign(q(v),u(v.shortName,w)),v.defaultConfig.parent=w),or(d,v,"effect"),v},exports.clearNode=nr,exports.combine=g,exports.createApi=function(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++)n[t]=arguments[t];var a=f(n),i=a[0],o=i[0],u=i[1],s=a[1],c={};return e(u,(function(e,r){var n=c[r]=p(r,{parent:I(o),config:s});o.on(n,e),or(o,n)})),c},exports.createDomain=function n(t,o){var u=Xe({or:o,and:'string'==typeof t?{name:t}:t}),s=a({family:{type:"domain"},regional:1,parent:(null==u?void 0:u.domain)||(null==u?void 0:u.parent)}),f={history:{},graphite:s,hooks:{}};s.meta=ur("domain",f,{parent:(null==u?void 0:u.domain)||(null==u?void 0:u.parent),or:Object.assign({},u,{derived:1})}),e({Event:p,Effect:y,Store:m,Domain:n},(function(e,n){var t=n.toLowerCase(),a=p({named:"on"+n});f.hooks[t]=a;var o=new Set;f.history[t+"s"]=o,a.create=function(e){return i(a,e),e},$(j(a).seq,xe((function(e,r,n){return n.scope=null,e}))),a.watch((function(e){ie(f,[e]),o.add(e),e.ownerSet||(e.ownerSet=o),I(e)||(e.parent=f)})),ie(f,[a]),f["onCreate"+n]=function(e){return r(o,e),a.watch(e)},f["create"+n]=f[t]=function(r,n){var t=Xe({and:n,or:r});return null!=t&&t.domain?e(r,n):a(e(r,{parent:f,or:t}))}}));var c=I(f);return c&&e(f.hooks,(function(e,r){return ar(e,c.hooks[r])})),null!=u&&u.domain&&u.domain.hooks.domain(f),f},exports.createEffect=y,exports.createEvent=p,exports.createNode=a,exports.createStore=m,exports.createWatch=function(e){var r=e.unit,n=e.fn,t=e.scope,i=e.batch,o=[Ae.run({fn:function(e){return n(e)}})];i&&o.unshift(Ae.compute({priority:'sampler',batch:1})),_(r)&&o.unshift(Ae.mov({store:r.stateRef,to:'stack'}));var u=Array.isArray(r)?r:[r];if(t){var s=[],f=t.additionalLinks;return u.forEach((function(e){var r=f[e.graphite.id]||[];f[e.graphite.id]=r;var n=a({node:x(o,e),meta:{watchOp:e.kind}});r.push(n),s.push((function(){var e=r.indexOf(n);-1!==e&&r.splice(e,1),nr(n)}))})),c((function(){s.forEach((function(e){return e()}))}))}var d=a({node:o,parent:u,family:{owners:u}});return c((function(){nr(d)}))},exports.fork=function(e,t){var i,o=e;B(e)&&(J(0,'fork(domain)','fork()'),i=e,o=t);var u=function(e){var n=a({scope:{defers:[],inFlight:0,fxID:0},node:[xe((function(e,r,n){n.parent?'dec'===n.parent.node.meta.needFxCounter?r.inFlight-=1:(r.inFlight+=1,r.fxID+=1):r.fxID+=1})),ke({priority:"sampler",batch:1}),xe((function(e,n){var t=n.defers,a=n.fxID;n.inFlight>0||0===t.length||Promise.resolve().then((function(){n.fxID===a&&r(t.splice(0,t.length),(function(e){Ge(e.parentFork),e.rs(e.value)}))}))}),0,1)]}),t=a({node:[xe((function(e,r,n){var t=n.parent;if(t){var a=t.node;if(wr(t)){var i=R(n),o=a.meta.sid;i.sidIdMap[o]=a.scope.state.id,i.values.sidMap[o]=e;var u=a.meta.serialize;u&&i.sidSerializeSettings.set(o,'ignore'===u?{ignore:1}:{ignore:0,write:u.write})}}}))]}),i=a({node:[xe((function(e,r,n){var t=R(n),a=n.parent;t&&a&&wr(a)&&t.warnSerializeTraces.add(F(a.node,'storeTrace'))}))]}),o={cloneOf:e,reg:{},values:{sidMap:{},idMap:{}},sidIdMap:{},sidSerializeSettings:new Map,getState:function(e){if('current'in e)return $e(We,o,e,0).current;var r=j(e);return $e(We,o,r.scope.state,1).current},kind:"scope",graphite:a({family:{type:"domain",links:[n,t,i]},meta:{unit:'fork'},scope:{forkInFlightCounter:n}}),additionalLinks:{},handlers:{sidMap:{},unitMap:new Map},fxCount:n,storeChange:t,warnSerializeTraces:new Set,warnSerializeNode:i};return o}(i);if(o){if(o.values){var s=w(o.values,(function(e){return n(_(e)&&L(e),'Values map can contain only writable stores as keys')})),f=s.unitMap,c=s.hasSidDoubles;Object.assign(u.values.sidMap,s.sidMap),r(f,(function(e,r){if(u.values.idMap[r.stateRef.id]=e,u.sidIdMap[F(r,'sid')]=r.stateRef.id,'ignore'===F(r,'serialize')){var n=F(r,'sid');u.sidSerializeSettings.set(n,{ignore:1})}})),u.fromSerialize=!(Array.isArray(o.values)||o.values instanceof Map),u.hasSidDoubles=c}o.handlers&&(J(o.handlers instanceof Map||Array.isArray(o.handlers),'object with handlers','array'),u.handlers=w(o.handlers,(function(e){return n(V(e),"Handlers map can contain only effects as keys")})))}return u},exports.forward=function(e){var r='forward',n=f(e,1),t=n[0],i=t.from,o=t.to,u=n[1],c=s(r,u);return J(0,r,'sample',c),le(i,c,'"from"'),le(o,c,'"to"'),pe(c,o,'to'),tr(a({parent:i,child:o,meta:{op:r,config:u},family:{},regional:1}))},exports.fromObservable=function(e){ce(e);var r=M in e?e[M]():e;n(r.subscribe,'expect observable to have .subscribe');var t=p(),a=tr(t);return r.subscribe({next:t,error:a,complete:a}),t},exports.guard=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];var t=f(r),a=t[0],i=a[0],o=a[1],u=t[1],c=s('guard',u);return J(0,'guard','sample',c),o||(i=(o=i).source),b(o,c),hr('guard',o.clock,i,o.filter,o.target,null,o.name,u,!o.greedy,0,1)},exports.hydrate=function(e,t){var a=t.values;n(ue(a),'values property should be an object');var o=w(a),u=o.sidMap,s=o.unitMap,f=Object.getOwnPropertyNames(u),c={};r(s,(function(e,r){c[r.stateRef.id]=r}));var d,l,p,v=[],m=[];W(e)?(p=1,n((d=e).cloneOf,'scope should be created from domain'),J(0,'hydrate(fork(domain), { values })','fork({ values })'),l=j(d.cloneOf)):B(e)?(J(0,'hydrate(domain, { values })','fork({ values })'),l=j(e)):n(0,'first argument of hydrate should be domain or scope'),k(l,(function(e,r){if(r&&H(f,r)){$(v,e);var n=F(e,'serialize');n&&'ignore'!==n&&(u[r]=n.read(u[r])),$(m,u[r])}else e.scope.state.id in c&&($(v,e),$(m,s.get(c[e.scope.state.id])))}),1),i({target:v,params:m,scope:d}),p&&Object.assign(d.values.sidMap,u)},exports.is=G,exports.launch=i,exports.merge=function(e,r){var n=s('merge',r);le(e,n,'first argument');var t=p({name:o(e,'merge'),derived:1,and:r});return ar(e,t,[],'merge'),t},exports.restore=function(r,t,a){var i=s('restore',a);if(n(!_(r),'restore($store) is not supported',i),P(r)||V(r)){var o=I(r),u=m(t,{parent:o,name:r.shortName,and:a});return ar(V(r)?r.doneData:r,u),o&&o.hooks.store(u),u}var f=Array.isArray(r)?[]:{};return e(r,(function(e,r){return f[r]=_(e)?e:m(e,{name:r})})),f},exports.sample=function(){for(var e,r,n=arguments.length,t=new Array(n),a=0;a<n;a++)t[a]=arguments[a];var i,o,u=f(t),c=u[0],d=c[0],l=c[1],p=c[2],v=u[1],m=1,g=s('sample',v);return fe(l)&&ue(d)&&b(d,g)&&(l=d.clock,p=d.fn,'batch'in d?m=d.batch:(J(!('greedy'in d),'greedy in sample','batch',g),m=!d.greedy),o=d.filter,e=d.target,r=d.name,i=d.sid,d=d.source),hr('sample',l,d,o,e,p,r,v,m,1,0,i)},exports.scopeBind=function(e,r){var t=void 0===r?{}:r,a=t.scope;n(a||Fe||t.safe,'scopeBind: scope not found');var i=a||Fe;return function(){function r(){Ge(a)}var n,t=0,a=Fe;Ge(i);try{n=e.apply(void 0,arguments)}catch(o){n=o,t=1}if(r(),t)throw n;return n instanceof Promise&&n.then(r,r),n}},exports.serialize=function(t,a){void 0===a&&(a={}),t.warnSerializeTraces.size&&(console.error('serialize: One or more stores dont have sids, their values are omitted'),r(t.warnSerializeTraces,(function(e){K('store should have sid or `serialize: ignore`',e)}))),n(!t.hasSidDoubles,'duplicate sid found in this scope');var i=a.ignore?a.ignore.map((function(e){return e.sid})):[],o={};return e(t.values.sidMap,(function(e,r){var n;if(!H(i,r)){var a=t.sidIdMap[r],u=null!==(n=t.sidSerializeSettings.get(r))&&void 0!==n?n:{ignore:0,write:xr};u.ignore||(o[r]=(0,u.write)(a&&a in t.reg?t.reg[a].current:e))}})),'onlyChanges'in a&&(J(0,'onlyChanges'),a.onlyChanges||(n(t.cloneOf,'scope should be created from domain'),k(j(t.cloneOf),(function(e,r){r in o||H(i,r)||F(e,'isCombine')||'ignore'===F(e,'serialize')||(o[r]=t.getState(e))})))),o},exports.setGraphInspector=function(e){S=e},exports.setInspector=function(e){De=e},exports.setStoreName=function(e,r){e.shortName=r,Object.assign(q(e),u(r,I(e)))},exports.split=function(){for(var r,t,i='split',o=arguments.length,u=new Array(o),c=0;c<o;c++)u[c]=arguments[c];var l=f(u),v=l[0],m=v[0],g=v[1],h=l[1],y=s(i,h),b=!g;b&&(r=m.cases,g=m.match,t=m.clock,m=m.source);var k=_(g),w=!E(g)&&se(g),x=!k&&!w&&ue(g);n(E(m),'source must be a unit',y),r||(r={}),b?e(r,(function(e,r){return pe(y,e,"cases."+r)})):(n(x,'match should be an object',y),e(g,(function(e,n){return r[n]=p({derived:1,named:"cases."+n,and:h})})),r.__=p({derived:1,named:'cases.__',and:h}));var S,M=new Set([].concat(m,t||[],Object.values(r))),A=Object.keys(k||w?r:g);if(k||w)k&&M.add(g),S=[k&&Se(N(g),0,1),ke({safe:k,filter:1,pure:!k,fn:function(e,r,n){var t=String(k?n.a:g(e));kr(r,H(A,t)?t:'__',e,n)}})];else if(x){var j=je({});j.type='shape';var z,O=[];e(g,(function(e,r){if(E(e)){z=1,$(O,r),M.add(e);var n=ar(e,[],[Se(j),xe((function(e,n,t){return t.a[r]=e}))]);if(_(e)){j.current[r]=e.getState();var t=N(e);Oe(j,{from:t,field:r,type:'field'}),d('splitMatchStore',t,n)}}})),z&&d('splitBase',j),S=[z&&Se(j,0,1),Me((function(e,r,n){for(var t=0;t<A.length;t++){var a=A[t];if(H(O,a)?n.a[a]:g[a](e))return void kr(r,a,e,n)}kr(r,'__',e,n)}),1)]}else n(0,'expect match to be unit, function or object');var C=a({meta:{op:i},parent:t?[]:m,scope:r,node:S,family:{owners:Array.from(M)},regional:1});if(t&&hr(i,t,m,null,C,null,i,h,0,0,0),!b)return r},exports.step=Ae,exports.version="23.3.0",exports.withFactory=function(e){var r=e.sid,n=e.name,i=e.loc,o=e.method,u=e.fn;return t(a({meta:{sidRoot:ae(r),sid:r,name:n,loc:i,method:o,type:'factory'},regional:1}),u)},exports.withRegion=t;
//# sourceMappingURL=compat.js.map
